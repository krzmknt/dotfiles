#!/bin/bash
#
# Cross-platform dotfiles installer
# Supports: macOS, Ubuntu, Amazon Linux 2023, Fedora
#

set -e

# ===========================
# Clone this repo (if needed)

remote_repository_path=github.com/krzmknt/dotfiles
local_repository_path=~/ghq/$remote_repository_path

if [ ! -d "$local_repository_path" ]; then
  echo "Cloning dotfiles repository..."
  mkdir -p ~/ghq/github.com/krzmknt
  git clone "https://$remote_repository_path" "$local_repository_path"
fi

cd "$local_repository_path"

# ===========================
# Run install scripts in order

INSTALL_DIR="$local_repository_path/install.d"

echo "Starting dotfiles installation..."
echo ""

for script in "$INSTALL_DIR"/*.sh; do
  if [[ -f "$script" ]]; then
    echo "========================================"
    echo "Running: $(basename "$script")"
    echo "========================================"
    source "$script"
    echo ""
  fi
done

echo "========================================"
echo "Installation complete!"
echo "========================================"
echo ""
echo "Please restart your shell or run:"
echo "  source ~/.zshrc"
echo ""
